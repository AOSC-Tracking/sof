<include/components/tdfb.conf>

Object.Widget.tdfb.1 {
	index		$DMIC0_TDFB_HOST_PIPELINE_ID
	Object.Control {
		bytes."1" {
			name 'Dmic0 Capture TDFB bytes'
			max 16384
			IncludeByKey.EFX_DMIC0_TDFB_PARAMS {
				"line2_pass" "include/components/tdfb/line2_pass.conf"
				"line2_generic_pm10deg" "include/components/tdfb/line2_generic_pm10deg_48khz.conf"
				"line2_50mm" "include/components/tdfb/line2_50mm_pm0_30_90deg_48khz.conf"
				"line2_68mm" "include/components/tdfb/line2_68mm_pm0_30_90deg_48khz.conf"
				"line2_74mm" "include/components/tdfb/line2_74mm_pm0_30_90deg_48khz.conf"
				"line4_pass" "include/components/tdfb/line4to2_pass.conf"
				"line4_generic_pm10deg" "include/components/tdfb/line4_generic_pm10deg_48khz.conf"
				"line4_28mm" "include/components/tdfb/line2_28mm_pm0_30_90deg_48khz.conf"
			}
		}
		mixer."1" {
			name 'Dmic0 Capture TDFB beam switch'
		}
		enum."1" {
			name 'Dmic0 Capture TDFB angle set enum'
		}
		# Tracking is disabled from this topology, causes high MCPS
		#mixer."2" {
		#	 name 'Dmic0 Capture TDFB track switch'
		#}
		#enum."2" {
		#	 name 'Dmic0 Capture TDFB angle estimate enum'
		#}
	}
	IncludeByKey.NUM_DMICS {
                "2" {
                        num_input_audio_formats	1
                        Object.Base.input_audio_format [
                                {
                                        input_pin_index		0
                                        in_rate			$DMIC0_RATE
                                        in_channels		2
                                        in_bit_depth		32
                                        in_valid_bit_depth	32
                                }
                        ]
                }
                "4" {
                        num_input_audio_formats	1
                        Object.Base.input_audio_format [
                                {
                                        input_pin_index		0
                                        in_rate			$DMIC0_RATE
                                        in_channels		4
                                        in_bit_depth		32
                                        in_valid_bit_depth	32
                                        in_ch_cfg               $CHANNEL_CONFIG_3_POINT_1
                                        in_ch_map               $CHANNEL_MAP_3_POINT_1
                                }
                        ]
                }
        }
	num_output_audio_formats	1
	Object.Base.output_audio_format [
		{
			input_pin_index		0
			out_channels		2
			out_rate		$DMIC0_RATE
			out_bit_depth		32
			out_valid_bit_depth	32
		}
	]
}

Object.Widget.drc.1 {
	index		$DMIC0_TDFB_HOST_PIPELINE_ID
	Object.Control {
		bytes."1" {
			name 'Dmic0 Capture DRC bytes'
			IncludeByKey.EFX_DMIC0_DRC_PARAMS {
				"passthrough" "include/components/drc/passthrough.conf"
				"dmic_default" "include/components/drc/dmic_default.conf"
			}
		}
		mixer."1" {
			name 'Dmic0 Capture DRC switch'
		}
	}
	num_input_audio_formats	    1
	Object.Base.input_audio_format [
		{
			in_rate			$DMIC0_RATE
			in_bit_depth		32
			in_valid_bit_depth	32
		}
	]
	num_output_audio_formats	1
	Object.Base.output_audio_format [
		{
			out_rate		$DMIC0_RATE
			out_bit_depth		32
			out_valid_bit_depth	32
		}
	]
}

Object.Pipeline.host-gateway-capture [
	{
		index		$DMIC0_TDFB_HOST_PIPELINE_ID
		Object.Widget.host-copier.1 {
			stream_name $DMIC0_TDFB_PCM_CAPS
			pcm_id $DMIC0_TDFB_PCM_ID
			num_input_audio_formats	1
			Object.Base.input_audio_format [
				{
					in_rate			$DMIC0_RATE
					in_bit_depth		32
					in_valid_bit_depth	32
				}
			]
			num_output_audio_formats	1
			Object.Base.output_audio_format [
				{
					out_rate		$DMIC0_RATE
					out_bit_depth		32
					out_valid_bit_depth	32
				}
			]
		}
	}
]

Object.Base.route [
	{
		source	$DMIC0_DAI_PIPELINE_SRC
		sink	tdfb.$DMIC0_TDFB_HOST_PIPELINE_ID.1
	}
	{
		source	tdfb.$DMIC0_TDFB_HOST_PIPELINE_ID.1
		sink	drc.$DMIC0_TDFB_HOST_PIPELINE_ID.1
	}
	{
		source	drc.$DMIC0_TDFB_HOST_PIPELINE_ID.1
		sink	host-copier.$DMIC0_TDFB_PCM_ID.capture
	}
]

Object.PCM.pcm [
	{
		name	"$DMIC0_TDFB_PCM_NAME"
		id $DMIC0_TDFB_PCM_ID
		direction	"capture"
		Object.Base.fe_dai.1 {
			name "$DMIC0_TDFB_PCM_NAME"
		}

		Object.PCM.pcm_caps.1 {
			name $DMIC0_TDFB_PCM_CAPS
			formats 'S32_LE'
			channels_min 2
			channels_max 2
			rate_min $DMIC0_RATE
			rate_max $DMIC0_RATE
		}
	}
]
