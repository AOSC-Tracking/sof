<include/components/tdfb.conf>

Object.Widget.tdfb.1 {
	index		$HDA_MIC_TDFB_HOST_PIPELINE_ID
	Object.Control {
		bytes."1" {
			name 'Analog Capture TDFB bytes'
			max 16384
			IncludeByKey.EFX_HDA_MIC_TDFB_PARAMS {
				"line2_pass" "include/components/tdfb/line2_pass.conf"
				"line2_generic_pm10deg" "include/components/tdfb/line2_generic_pm10deg_48khz.conf"
				"line2_50mm" "include/components/tdfb/line2_50mm_pm0_30_90deg_48khz.conf"
				"line2_68mm" "include/components/tdfb/line2_68mm_pm0_30_90deg_48khz.conf"
				"line2_74mm" "include/components/tdfb/line2_74mm_pm0_30_90deg_48khz.conf"
				"line4_pass" "include/components/tdfb/line4to2_pass.conf"
				"line4_generic_pm10deg" "include/components/tdfb/line4_generic_pm10deg_48khz.conf"
				"line4_28mm" "include/components/tdfb/line2_28mm_pm0_30_90deg_48khz.conf"
			}
		}
		mixer."1" {
			name 'Analog Capture TDFB beam switch'
		}
		enum."1" {
			name 'Analog Capture TDFB angle set enum'
		}
		# Tracking is disabled from this topology, causes high MCPS
		#mixer."2" {
		#	 name 'Analog Capture TDFB track switch'
		#}
		#enum."2" {
		#	 name 'Analog Capture TDFB angle estimate enum'
		#}
	}
	num_input_audio_formats	1
	Object.Base.input_audio_format [
		{
			input_pin_index		0
			in_rate			$HDA_ANALOG_CAPTURE_RATE
			in_channels		2
			in_bit_depth		32
			in_valid_bit_depth	32
		}
	]
	num_output_audio_formats	1
	Object.Base.output_audio_format [
		{
			output_pin_index	0
			out_channels		2
			out_rate		$HDA_ANALOG_CAPTURE_RATE
			out_bit_depth		32
			out_valid_bit_depth	32
		}
	]
}

Object.Widget.drc.1 {
	index		$HDA_MIC_TDFB_HOST_PIPELINE_ID
	Object.Control {
		bytes."1" {
			name 'Analog Capture DRC bytes'
			IncludeByKey.EFX_HDA_MIC_DRC_PARAMS {
				"passthrough" "include/components/drc/passthrough.conf"
				"dmic_default" "include/components/drc/dmic_default.conf"
			}
		}
		mixer."1" {
			name 'Analog Capture DRC switch'
		}
	}
	num_input_audio_formats	    1
	Object.Base.input_audio_format [
		{
			in_rate			$HDA_ANALOG_CAPTURE_RATE
			in_bit_depth		32
			in_valid_bit_depth	32
		}
	]
	num_output_audio_formats	1
	Object.Base.output_audio_format [
		{
			out_rate		$HDA_ANALOG_CAPTURE_RATE
			out_bit_depth		32
			out_valid_bit_depth	32
		}
	]
}

Object.Pipeline.host-gateway-capture [
	{
		index		$HDA_MIC_TDFB_HOST_PIPELINE_ID
		Object.Widget.host-copier.1 {
			stream_name $HDA_MIC_TDFB_PCM_CAPS
			pcm_id $HDA_MIC_TDFB_PCM_ID
			num_input_audio_formats	1
			Object.Base.input_audio_format [
				{
					in_rate			$HDA_ANALOG_CAPTURE_RATE
					in_bit_depth		32
					in_valid_bit_depth	32
				}
			]
			num_output_audio_formats	1
			Object.Base.output_audio_format [
				{
					out_rate		$HDA_ANALOG_CAPTURE_RATE
					out_bit_depth		32
					out_valid_bit_depth	32
				}
			]
		}
	}
]

Object.Base.route [
	{
		source	$HDA_MIC_DAI_PIPELINE_SRC
		sink	tdfb.$HDA_MIC_TDFB_HOST_PIPELINE_ID.1
	}
	{
		source	tdfb.$HDA_MIC_TDFB_HOST_PIPELINE_ID.1
		sink	drc.$HDA_MIC_TDFB_HOST_PIPELINE_ID.1
	}
	{
		source	drc.$HDA_MIC_TDFB_HOST_PIPELINE_ID.1
		sink	host-copier.$HDA_MIC_TDFB_PCM_ID.capture
	}
]

Object.PCM.pcm [
	{
		name	"$HDA_MIC_TDFB_PCM_NAME"
		id $HDA_MIC_TDFB_PCM_ID
		direction	"capture"
		Object.Base.fe_dai.1 {
			name "$HDA_MIC_TDFB_PCM_NAME"
		}

		Object.PCM.pcm_caps.1 {
			name $HDA_MIC_TDFB_PCM_CAPS
			formats 'S32_LE'
			channels_min 2
			channels_max 2
			rate_min $HDA_ANALOG_CAPTURE_RATE
			rate_max $HDA_ANALOG_CAPTURE_RATE
		}
	}
]
