<include/dais/dmic.conf>
<include/dais/pdm_config.conf>
# This file should be included from other top-level topology files. So do not include other
# conf's in this file.

#
# Arguments to be passed when compiling this conf file. All of them come with default values.
# These can be modified by passing the argument values with alsatplg as follows:
# alsatplg -D DMIC0_ID=4,DMIC1_ID=5,DMIC_CH_COUNT=4 -p -c dmic_generic.conf -o output.conf
#

Define {
	# Link ID for DMIC 480KHz in the machine driver
	DMIC0_ID		6
	DMIC0_PIPELINE_ID	10
	DMIC0_PCM_ID		6
	DMIC0_EQIIR_COEFF	"eqiir_highpass_40hz_20db_48khz"

	# Link ID for DMIC 16Khz in the machine driver
	DMIC1_ID		7
	DMIC1_PIPELINE_ID	11
	DMIC1_PCM_ID		7
	DMIC1_EQIIR_COEFF	"eqiir_highpass_40hz_20db_16khz"

	# Number of active PDM controllers.
	NUM_PDM		1

	# Source widget name in the pipeline that connects to the DMIC0 DAI
	DMIC0_PIPELINE_SOURCE	"buffer.10.3"

	# Source widget name in the pipeline that connects to the DMIC1 DAI
	DMIC1_PIPELINE_SOURCE	"buffer.11.3"

	# Stream name for the host widget for the DMIC0 pipeline. This should be the same as the
	# PCM capabilities for the PCM that this widget is connected to
	DMIC0_HOST_STREAM_NAME	"Highpass Capture 6"

	# Stream name for the host widget for the DMIC0 pipeline. This should be the same as the
	# PCM capabilities for the PCM that this widget is connected to
	DMIC1_HOST_STREAM_NAME	"Highpass Capture 7"

	# DMIC0 EQIIR byte control name
	DMIC0_EQIIR_BYTES_NAME "eqiir_bytes_10"

	# DMIC1 EQIIR byte control name
	DMIC1_EQIIR_BYTES_NAME "eqiir_bytes_11"

	CHANNELS	2

	FORMAT "s32le"
}

# DMIC DAI definition
Object.Dai {
	DMIC.0 {
		name dmic01
		id $DMIC0_ID
		default_hw_config_id $DMIC0_ID
		unmute_ramp_time_ms 200
		num_pdm_active $NUM_PDM
		IncludeByKey.DMIC_CH_COUNT {
			"[1-2]" "include/platform/intel/pdm-config-2ch.conf"
			"[3-4]" "include/platform/intel/pdm-config-4ch.conf"
		}
		Object.Base.hw_config.DMIC0 {}
		Object.Widget.dai.0 {
			stream_name dmic01
			index $DMIC0_PIPELINE_ID
			type dai_out
			period_sink_count 2
			period_source_count 0
			format $FORMAT
		}
	}
	DMIC.1 {
		name dmic16k
		id $DMIC1_ID
		default_hw_config_id $DMIC1_ID
		sample_rate 16000
		num_pdm_active $NUM_PDM
		IncludeByKey.DMIC_CH_COUNT {
			"[1-2]" "include/platform/intel/pdm-config-2ch.conf"
			"[3-4]" "include/platform/intel/pdm-config-4ch.conf"
		}
		Object.Base.hw_config.DMIC1 {}
		Object.Widget.dai.0 {
			stream_name dmic16k
			index $DMIC1_PIPELINE_ID
			type dai_out
			period_sink_count 2
			period_source_count 0
			format $FORMAT
		}
	}
}

# Capture pipeline definition
Object.Pipeline {
	eq-iir-volume-capture.100 {
		dynamic_pipeline	$DYNAMIC_PIPELINE
		index $DMIC0_PIPELINE_ID
		Object.Widget.pipeline.1 {
			stream_name 'dai.DMIC.0.capture'
		}
		Object.Widget.host.capture {
			stream_name $DMIC0_HOST_STREAM_NAME
		}
		Object.Widget.pga.1 {
			Object.Control.mixer.1 {
				name 'Capture Volume'
			}
			Object.Control.mixer.2 {
				mute_led_use	1
				mute_led_direction 1
				name 'Capture Switch'
			}
		}
		Object.Widget.eqiir.1 {
			Object.Control.bytes.1 {
				name $DMIC0_EQIIR_BYTES_NAME
				IncludeByKey.DMIC0_EQIIR_COEFF {
					"highpass_40hz_0db_48khz" "include/components/eqiir/highpass_40hz_0db_48khz.conf"
					"highpass_40hz_20db_48khz" "include/components/eqiir/highpass_40hz_20db_48khz.conf"
				}
			}
		}
		format $FORMAT
		channels	$CHANNELS
	}
	eq-iir-volume-capture.101 {
		Object.Widget.pipeline.1 {
			stream_name 'dai.DMIC.1.capture'
		}
		Object.Widget.host.capture {
			stream_name $DMIC1_HOST_STREAM_NAME
		}
		Object.Widget.pga.1 {
			Object.Control.mixer.1 {
				name '2nd Capture Volume'
			}
		}
		Object.Widget.eqiir.1 {
			Object.Control.bytes.1 {
				name $DMIC1_EQIIR_BYTES_NAME
				IncludeByKey.DMIC1_EQIIR_COEFF {
					"highpass_40hz_20db_16khz" "include/components/eqiir/highpass_40hz_20db_16khz.conf"
				}
			}
		}
		dynamic_pipeline	$DYNAMIC_PIPELINE
		index $DMIC1_PIPELINE_ID
		rate 16000
		format $FORMAT
		channels	$CHANNELS
	}
}
Object.PCM {
	pcm.100 {
		name DMIC
		id $DMIC0_PCM_ID
		Object.Base.fe_dai.DMIC [
		]
		Object.PCM.pcm_caps.capture {
			name $DMIC0_HOST_STREAM_NAME
			channels_min	$CHANNELS
			channels_max	$CHANNELS
		}
		direction capture
	}
	pcm.101 {
		name DMIC16kHz
		id $DMIC1_PCM_ID
		Object.Base.fe_dai.DMIC16kHz [
		]
		Object.PCM.pcm_caps.capture {
			name $DMIC1_HOST_STREAM_NAME
			rate_min 16000
			rate_max 16000
			channels_min	$CHANNELS
			channels_max	$CHANNELS
		}
		direction capture
	}
}

# routes starting with ID 100 to avoid being overridden when included in the top-level topology
Object.Base {
	route."100" {
		sink $DMIC0_PIPELINE_SOURCE
		source 'dai.DMIC.0.capture'
	}
	route. "101" {
		sink $DMIC1_PIPELINE_SOURCE
		source 'dai.DMIC.1.capture'
	}
}
